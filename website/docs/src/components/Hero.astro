---
import { Icon } from "@astrojs/starlight/components";
import Rust from "~icons/devicon-plain/rust";
import { withBase } from "../utils/links";

const heroFromProps = Astro.props?.hero;
const heroFromRoute = Astro.locals?.starlightRoute?.entry?.data?.hero;
const hero = heroFromProps ?? heroFromRoute ?? {};
const title =
	hero.title ?? "Sync your AI agents across all assistants — instantly.";
const tagline =
	hero.tagline ??
	"Keep AI agent configurations consistent across all your assistants. AgentSync automates syncing across workspaces so you can focus on coding, not configuration.";

// Handle Astro's image object (has .src property) or use fallback
const rawImage = hero?.image?.file;
const imageFile =
	typeof rawImage === "object" && rawImage?.src
		? rawImage.src
		: withBase(typeof rawImage === "string" ? rawImage : "/synchro.svg");

const actions = (
	hero?.actions ?? [
		{
			text: "Get started",
			link: "/guides/getting-started/",
			variant: "primary",
		},
		{ text: "Contribute", link: "/guides/contributing/", variant: "secondary" },
	]
).map((action) => ({
	...action,
	link: typeof action.link === "string" ? withBase(action.link) : action.link,
}));
---

<header class="hero">
  <div class="hero-bg-glow" aria-hidden="true"></div>
  <div class="hero-grid-pattern" aria-hidden="true"></div>
  <div class="hero-inner">
    <div class="hero-copy animate-fade-in-up">
      <div class="hero-badge">
        <span class="badge-dot"></span>
        <span>Open Source · MIT License</span>
      </div>
      <h1 class="hero-title">{title}</h1>
      <p class="hero-sub">{tagline}</p>
      <div class="hero-cta">
        {
          actions.map((a) =>
            a.variant === "primary" ? (
              <a class="btn primary" href={a.link}>
                {a.text}
                <svg
                  class="btn-arrow"
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                >
                  <path
                    d="M3 8h10m0 0L9 4m4 4L9 12"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </a>
            ) : (
              <a class="btn secondary" href={a.link}>
                {a.text}
              </a>
            ),
          )
        }
      </div>
      <div class="hero-tech-badges">
        <span class="tech-badge">
          <Icon name="pnpm" label="pnpm logo" />
          pnpm
        </span>
        <span class="tech-badge">
          <Rust aria-hidden />
          Cargo
        </span>
        <span class="tech-badge">
          <Icon name="astro" label="Astro logo" />
          Astro
        </span>
      </div>
    </div>
    <div class="hero-visual animate-fade-in-up" style="animation-delay: 0.15s;">
      <div class="robot-wrap">
        <div class="robot-glow" aria-hidden="true"></div>
        <img src={imageFile} alt="agentsync robot" class="robot" />
      </div>
    </div>
  </div>
</header>

<style>
  /* ===== Hero Container ===== */
  .hero {
    position: relative;
    overflow: hidden;
    padding: var(--as-space-3xl, 64px) var(--as-space-lg, 24px);
    min-height: 80vh;
    display: flex;
    align-items: center;
    background: var(--as-hero-bg, var(--as-bg-base, #07070a));
    color: var(--as-text-primary, #fff);
  }

  /* Gradient Glow Background */
  .hero-bg-glow {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(
        ellipse 100% 80% at 20% 0%,
        var(--as-hero-glow-1, rgba(0, 229, 196, 0.08)),
        transparent 50%
      ),
      radial-gradient(
        ellipse 80% 60% at 80% 100%,
        var(--as-hero-glow-2, rgba(124, 77, 255, 0.06)),
        transparent 40%
      );
    pointer-events: none;
  }

  /* Subtle Grid Pattern */
  .hero-grid-pattern {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(
        var(--as-border, rgba(255, 255, 255, 0.015)) 1px,
        transparent 1px
      ),
      linear-gradient(
        90deg,
        var(--as-border, rgba(255, 255, 255, 0.015)) 1px,
        transparent 1px
      );
    background-size: 60px 60px;
    pointer-events: none;
    opacity: 0.5;
  }

  /* ===== Inner Layout ===== */
  .hero-inner {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: var(--as-space-xl, 32px);
    align-items: center;
  }

  /* ===== Hero Copy ===== */
  .hero-copy {
    display: flex;
    flex-direction: column;
    gap: var(--as-space-md, 16px);
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--as-space-sm, 8px);
    padding: var(--as-space-xs, 4px) var(--as-space-md, 16px);
    background: rgba(0, 229, 196, 0.08);
    border: 1px solid rgba(0, 229, 196, 0.2);
    border-radius: 999px;
    font-size: 0.8rem;
    color: var(--as-primary, #00e5c4);
    width: fit-content;
  }

  .badge-dot {
    width: 6px;
    height: 6px;
    background: var(--as-primary, #00e5c4);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.4;
    }
  }

  .hero-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    line-height: 1.1;
    font-weight: 800;
    letter-spacing: -0.03em;
    margin: 0;
    color: var(--as-text-primary, #fff);
  }

  .hero-sub {
    font-size: clamp(1rem, 2vw, 1.2rem);
    line-height: 1.6;
    color: var(--as-text-secondary, #9aa7b3);
    margin: 0;
    max-width: 500px;
  }

  /* ===== CTA Buttons ===== */
  .hero-cta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--as-space-md, 16px);
    margin-top: var(--as-space-sm, 8px);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--as-space-sm, 8px);
    padding: 14px 24px;
    border-radius: var(--as-radius-md, 10px);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.95rem;
    transition:
      transform var(--as-transition-fast, 150ms ease),
      box-shadow var(--as-transition-fast, 150ms ease),
      background var(--as-transition-fast, 150ms ease);
  }

  .btn.primary {
    background: linear-gradient(
      135deg,
      var(--as-primary, #00e5c4),
      var(--as-secondary, #7c4dff)
    );
    color: #07070a;
    box-shadow: 0 8px 24px rgba(0, 229, 196, 0.2);
  }

  .btn.primary:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 12px 32px rgba(0, 229, 196, 0.3);
  }

  .btn-arrow {
    transition: transform var(--as-transition-fast, 150ms ease);
  }

  .btn.primary:hover .btn-arrow {
    transform: translateX(4px);
  }

  .btn.secondary {
    background: var(--as-bg-card, rgba(255, 255, 255, 0.04));
    color: var(--as-text-primary, #fff);
    border: 1px solid var(--as-border, rgba(255, 255, 255, 0.08));
  }

  .btn.secondary:hover {
    background: var(--as-bg-surface, rgba(255, 255, 255, 0.08));
    border-color: var(--as-border-hover, rgba(255, 255, 255, 0.15));
  }

  /* ===== Tech Badges ===== */
  .hero-tech-badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--as-space-sm, 8px);
    margin-top: var(--as-space-md, 16px);
  }

  .tech-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: var(--as-space-sm, 8px) var(--as-space-md, 16px);
    background: var(--as-bg-card, rgba(255, 255, 255, 0.03));
    border: 1px solid var(--as-border, rgba(255, 255, 255, 0.08));
    border-radius: var(--as-radius-sm, 6px);
    font-size: 0.8rem;
    color: var(--as-text-muted, #6b7280);
    transition: all var(--as-transition-fast, 150ms ease);
  }

  .tech-badge:hover {
    background: var(--as-bg-surface, rgba(255, 255, 255, 0.06));
    color: var(--as-text-secondary, #9aa7b3);
    border-color: var(--as-border-hover, rgba(255, 255, 255, 0.15));
  }

  .tech-badge svg {
    opacity: 0.7;
  }

  /* ===== Hero Visual ===== */
  .hero-visual {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .robot-wrap {
    position: relative;
    width: 380px;
    height: 380px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .robot-glow {
    position: absolute;
    width: 300px;
    height: 300px;
    background: radial-gradient(
      circle,
      rgba(0, 229, 196, 0.15),
      transparent 60%
    );
    border-radius: 50%;
    filter: blur(40px);
    animation: glow-pulse 4s ease-in-out infinite;
  }

  @keyframes glow-pulse {
    0%,
    100% {
      transform: scale(0.95);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.9;
    }
  }

  .robot {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 16px 40px rgba(0, 0, 0, 0.5));
    animation: float 6s ease-in-out infinite;
  }

  @keyframes float {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-12px);
    }
  }

  /* ===== Fade-in Animation ===== */
  .animate-fade-in-up {
    opacity: 0;
    animation: fadeInUp 0.8s ease forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(24px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ===== Responsive ===== */
  @media (max-width: 900px) {
    .hero {
      padding: var(--as-space-2xl, 48px) var(--as-space-md, 16px);
      min-height: auto;
    }

    .hero-inner {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .hero-copy {
      align-items: center;
    }

    .hero-sub {
      max-width: 100%;
    }

    .hero-cta {
      justify-content: center;
    }

    .hero-tech-badges {
      justify-content: center;
    }

    .hero-visual {
      order: -1;
      margin-bottom: var(--as-space-lg, 24px);
    }

    .robot-wrap {
      width: 280px;
      height: 280px;
    }
  }
</style>
